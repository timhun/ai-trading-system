import os
import psycopg2
from datetime import datetime
from dotenv import load_dotenv

load_dotenv()
conn = psycopg2.connect(os.getenv('DATABASE_URL'))
cur = conn.cursor()

# æ¸…é™¤èˆŠçš„æ¸¬è©¦è³‡æ–™
cur.execute("DELETE FROM raw_content WHERE source_id LIKE 'test_%'")
print("âœ… å·²æ¸…é™¤èˆŠçš„æ¸¬è©¦è³‡æ–™")

# æ’å…¥çœŸå¯¦çš„æŠ•è³‡ç­–ç•¥ç¯„ä¾‹
test_strategies = [
    {
        "source_id": "test_strategy_001",
        "title": "å‡ç·šé»ƒé‡‘äº¤å‰åšå¤šç­–ç•¥",
        "text": """ã€å‡ç·šé»ƒé‡‘äº¤å‰åšå¤šç­–ç•¥ã€‘

é€™æ˜¯ä¸€å€‹ç¶“å…¸çš„æŠ€è¡“åˆ†æç­–ç•¥ï¼Œåˆ©ç”¨çŸ­æœŸèˆ‡é•·æœŸå‡ç·šçš„äº¤å‰ä¾†åˆ¤æ–·é€²å‡ºå ´æ™‚æ©Ÿã€‚

é€²å ´æ¢ä»¶ï¼š
1. 5æ—¥å‡ç·šå‘ä¸Šçªç ´20æ—¥å‡ç·šï¼ˆé»ƒé‡‘äº¤å‰ï¼‰
2. çªç ´ç•¶æ—¥æˆäº¤é‡éœ€æ”¾å¤§è‡³20æ—¥å‡é‡çš„1.5å€ä»¥ä¸Š
3. è‚¡åƒ¹å¿…é ˆç«™åœ¨60æ—¥å­£ç·šä¹‹ä¸Š
4. RSIæŒ‡æ¨™ä»‹æ–¼40-70ä¹‹é–“ï¼ˆé¿å…è¶…è²·å€ï¼‰

å‡ºå ´æ¢ä»¶ï¼š
1. 5æ—¥å‡ç·šå‘ä¸‹è·Œç ´20æ—¥å‡ç·šï¼ˆæ­»äº¡äº¤å‰ï¼‰
2. åœæï¼šè·Œç ´é€²å ´åƒ¹æ ¼çš„5%
3. åœåˆ©ï¼šç²åˆ©é”15%æ™‚ï¼Œåˆ†æ‰¹å‡ºå ´50%

é¢¨éšªæ§ç®¡ï¼š
- å–®ä¸€å€‹è‚¡æŠ•å…¥è³‡é‡‘ä¸è¶…éç¸½è³‡é‡‘çš„10%
- åŒæ™‚æŒæœ‰ä¸è¶…é5æª”å€‹è‚¡
- åš´æ ¼åŸ·è¡Œåœæï¼Œä¸å‡¹å–®"""
    },
    {
        "source_id": "test_strategy_002",
        "title": "çªç ´å‰é«˜ç­–ç•¥ - é‡åƒ¹é…åˆæ³•",
        "text": """ã€çªç ´å‰é«˜ç­–ç•¥ - é‡åƒ¹é…åˆæ³•ã€‘

ç•¶è‚¡åƒ¹çªç ´è¿‘æœŸé«˜é»æ™‚ï¼Œè‹¥é…åˆæˆäº¤é‡æ”¾å¤§ï¼Œé€šå¸¸ä»£è¡¨æ–°ä¸€æ³¢æ¼²å‹¢å•Ÿå‹•ã€‚

é€²å ´è¨Šè™Ÿï¼š
âœ“ è‚¡åƒ¹çªç ´è¿‘60å€‹äº¤æ˜“æ—¥çš„æœ€é«˜åƒ¹
âœ“ çªç ´æ—¥æˆäº¤é‡è¶…éè¿‘20æ—¥å¹³å‡é‡çš„2å€
âœ“ çªç ´å¾Œé€£çºŒ3æ—¥ä¸è·Œç ´çªç ´é»

å‡ºå ´è¦å‰‡ï¼š
âœ— è·Œç ´çªç ´é»å³åœæå‡ºå ´
âœ— å‡ºç¾é•·ä¸Šå½±ç·šä¸”æ”¶ç›¤åƒ¹ä½æ–¼ç•¶æ—¥æœ€ä½1/3è™•ï¼Œæ¸›ç¢¼50%
âœ— ç²åˆ©20%ä»¥ä¸Šï¼Œæ¡ç”¨ç§»å‹•åœåˆ©ï¼ˆå›æª”5%å‡ºå ´ï¼‰

è³‡é‡‘åˆ†é…ï¼š
æ¯æ¬¡é€²å ´ä½¿ç”¨15%è³‡é‡‘ï¼Œæœ€å¤šåŒæ™‚æŒæœ‰3æª”æ¨™çš„ã€‚"""
    },
    {
        "source_id": "test_strategy_003",
        "title": "åƒ¹å€¼æŠ•è³‡é¸è‚¡æ³• - é•·æœŸæŒæœ‰",
        "text": """ã€åƒ¹å€¼æŠ•è³‡é¸è‚¡æ³• - é•·æœŸæŒæœ‰ã€‘

é¸æ“‡é«”è³ªå„ªè‰¯ã€ç²åˆ©ç©©å®šçš„å…¬å¸ï¼Œåœ¨åƒ¹æ ¼ä½ä¼°æ™‚è²·é€²ä¸¦é•·æœŸæŒæœ‰ã€‚

é¸è‚¡æ¢ä»¶ï¼š
1. é€£çºŒ5å¹´ ROE > 15%
2. è² å‚µæ¯” < 50%
3. è‡ªç”±ç¾é‡‘æµç‚ºæ­£
4. æœ¬ç›Šæ¯”ä½æ–¼ç”¢æ¥­å¹³å‡
5. æ®–åˆ©ç‡ > 4%

è²·é€²æ™‚æ©Ÿï¼š
- è‚¡åƒ¹æ·¨å€¼æ¯” < 1.5
- æŠ€è¡“é¢å‡ºç¾å­£ç·šæ”¯æ’
- å¤§ç›¤å›æª”æ™‚åˆ†æ‰¹è²·é€²

æŒæœ‰ç­–ç•¥ï¼š
â†’ é è¨ˆæŒæœ‰3-5å¹´
â†’ æ¯å­£æª¢è¦–è²¡å ±ï¼ŒåŸºæœ¬é¢æƒ¡åŒ–å³å‡ºå ´
â†’ è‚¡åƒ¹æ¼²è‡³æœ¬ç›Šæ¯” > 20 æ™‚ï¼Œæ¸›ç¢¼50%

é¢¨éšªç®¡ç†ï¼š
å–®ä¸€å€‹è‚¡ä¸è¶…é20%è³‡é‡‘ï¼Œåˆ†æ•£æ–¼5-8æª”ä¸åŒç”¢æ¥­çš„å„ªè³ªè‚¡ã€‚"""
    },
    {
        "source_id": "test_news_001",
        "title": "ä»Šæ—¥å°è‚¡ç›¤å‹¢åˆ†æ",
        "text": """ä»Šæ—¥å°è‚¡ç›¤å‹¢åˆ†æ

å°è‚¡ä»Šæ—¥é–‹é«˜èµ°ä½ï¼Œçµ‚å ´ä¸‹è·Œ85é»ï¼Œæ”¶åœ¨17,234é»ã€‚
ä¸‰å¤§æ³•äººè³£è¶…120å„„ï¼Œå¤–è³‡è³£è¶…100å„„ï¼ŒæŠ•ä¿¡è³£è¶…15å„„ã€‚

é¡è‚¡è¡¨ç¾ï¼š
é›»å­è‚¡ï¼šå°ç©é›»ä¸‹è·Œ1.5%ï¼Œè¯ç™¼ç§‘æŒå¹³
é‡‘èè‚¡ï¼šåœ‹æ³°é‡‘ä¸Šæ¼²0.8%ï¼Œå¯Œé‚¦é‡‘ä¸‹è·Œ0.3%

å¸‚å ´æ¶ˆæ¯ï¼šç¾è‚¡æ˜¨å¤œæ”¶é»‘ï¼Œé‚£æ–¯é”å…‹æŒ‡æ•¸è·Œ1.2%ã€‚
åˆ†æå¸«çœ‹æ³•ï¼šçŸ­æœŸæ•´ç†æ ¼å±€ï¼Œé—œæ³¨ç¾åœ‹åˆ©ç‡æ”¿ç­–å‹•å‘ã€‚"""
    }
]

now = datetime.now()

for item in test_strategies:
    cur.execute("""
        INSERT INTO raw_content (source_id, title, raw_text, published_at, status)
        VALUES (%s, %s, %s, %s, 'new')
    """, (item['source_id'], item['title'], item['text'], now))
    print(f"  âœ“ æ’å…¥ {item['source_id']}")

conn.commit()

print("\nâœ… æˆåŠŸæ’å…¥æ¸¬è©¦è³‡æ–™")
print("\nğŸ“Š é©—è­‰ï¼š")
cur.execute("""
    SELECT source_id, title, LENGTH(raw_text) as len, status 
    FROM raw_content 
    WHERE source_id LIKE 'test_%'
    ORDER BY source_id
""")
for row in cur.fetchall():
    print(f"  {row[0]}")
    print(f"    æ¨™é¡Œ: {row[1]}")
    print(f"    é•·åº¦: {row[2]} å­—å…ƒ")
    print(f"    ç‹€æ…‹: {row[3]}")

conn.close()
